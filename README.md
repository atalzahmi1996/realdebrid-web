# Real-Debrid WebDAV Media Browser

هذا المشروع عبارة عن مثال لموقع ويب بسيط مبني باستخدام إطار العمل **Flask** في لغة بايثون. يتيح الموقع تصفح مكتبة الملفات الموجودة في حساب **Real‑Debrid** عبر بروتوكول **WebDAV** وعرض معلومات وملصقات الأفلام والمسلسلات باستخدام واجهة برمجة تطبيقات **TMDb** (The Movie Database). كما يوفر الموقع أزرار تشغيل تُمكّن المستخدم من فتح الملفات في مشغلات فيديو خارجية مثل **VLC** أو **MX Player**.

> **ملاحظة مهمة:** بسبب قيود البيئة الحالية، لا يستطيع هذا الموقع الوصول فعلياً إلى خدمات الإنترنت الخارجية أو استخدام بيانات الدخول الخاصة بك. بدلاً من ذلك تم الاعتماد على متغيرات بيئة لتخزين بيانات حساب Real‑Debrid ومفتاح TMDb. عندما تقوم بتشغيل الموقع محلياً على جهازك، يجب عليك توفير هذه المتغيرات لكي يعمل الموقع بشكل صحيح.

## المتطلبات

- Python 3.9 أو أحدث.
- تثبيت الحزم الموجودة في `requirements.txt` باستخدام pip:

```bash
pip install -r requirements.txt
```

## إعداد متغيرات البيئة

قبل تشغيل التطبيق يجب عليك تحديد متغيرات البيئة التالية:

| المتغير                 | الوصف                                                                                   |
|-------------------------|-----------------------------------------------------------------------------------------|
| `RD_WEBDAV_URL`        | عنوان خادم WebDAV الخاص بـ Real‑Debrid. عادة يكون `https://webdav.real-debrid.com/`.      |
| `RD_WEBDAV_USERNAME`   | اسم المستخدم في حساب Real‑Debrid.                                                        |
| `RD_WEBDAV_PASSWORD`   | كلمة المرور (أو passkey) الخاصة بالوصول عبر WebDAV.                                       |
| `TMDB_API_KEY`         | مفتاح واجهة برمجة تطبيقات TMDb لاستخدامها في جلب المعلومات والملصقات الخاصة بالأفلام. |

مثال على إعداد المتغيرات في لينكس أو ماك:

```bash
export RD_WEBDAV_URL="https://webdav.real-debrid.com/"
export RD_WEBDAV_USERNAME="اسم_المستخدم"
export RD_WEBDAV_PASSWORD="كلمة_السر_او_passkey"
export TMDB_API_KEY="47b972fb486f4c35b33845e1a39359e0"
```

على نظام ويندوز يمكنك إعدادها من خلال موجه الأوامر (cmd) على هذا الشكل:

```cmd
set RD_WEBDAV_URL=https://webdav.real-debrid.com/
set RD_WEBDAV_USERNAME=اسم_المستخدم
set RD_WEBDAV_PASSWORD=كلمة_السر_او_passkey
set TMDB_API_KEY=47b972fb486f4c35b33845e1a39359e0
```

## تشغيل التطبيق

بعد تثبيت المتطلبات وتعيين متغيرات البيئة يمكنك تشغيل التطبيق باستخدام:

```bash
python app.py
```

بشكل افتراضي سيعمل الخادم على العنوان `http://127.0.0.1:5000/`. افتح هذا الرابط في المتصفح لرؤية واجهة الموقع.

## كيف يعمل الموقع؟

1. **الاتصال بـ Real‑Debrid عبر WebDAV:** يستخدم التطبيق وظيفة `list_webdav_files` لإرسال طلب من نوع `PROPFIND` إلى خادم WebDAV. يتولى هذا الطلب جلب قائمة بملفات ومجلدات حسابك. يتم تحليل الاستجابة لاستخراج أسماء الملفات ومساراتها.
2. **تخمين اسم الفيلم أو المسلسل:** يعتمد التطبيق على تحليل اسم الملف (إزالة الامتدادات والفواصل والأرقام) لتخمين اسم العمل الفني. هذا التخمين ليس مثالياً ولكنه عادة ما يعطي نتائج جيدة لمعظم الملفات.
3. **جلب بيانات TMDb:** من خلال مفتاح `TMDB_API_KEY` يتم استخدام واجهة TMDb للبحث عن عنوان الفيلم أو المسلسل وإحضار معلومات مثل الملصق (poster) والوصف (overview).
4. **عرض النتائج:** يتم عرض قائمة الأفلام أو الحلقات على الصفحة الرئيسية. لكل عنصر يُعرض الملصق، العنوان، الوصف، وزر تشغيل يتيح اختيار مشغل الفيديو الخارجي. عندما يختار المستخدم أحد المشغلات، يقوم الرابط بإنشاء URI مخصص مثل `vlc://URL_الملف` أو `mxplayer://URL_الملف` لفتح الملف مباشرة في التطبيق المختار (هذا يعتمد على دعم الجهاز لهذه البروتوكولات).

## ملاحظات إضافية

- إذا لم يكن لديك حساب Real‑Debrid أو لم تقم بتفعيل WebDAV في حسابك، يمكنك تشغيل التطبيق وسيستخدم بيانات تجريبية (مخزنة في `sample_data/sample_files.json`) لعرض بعض الأفلام الشهيرة كأمثلة.
- تم تقسيم القوالب على مجلد `templates` بينما توجد ملفات CSS في مجلد `static`. يمكنك تعديل التصاميم أو إضافة صفحات أخرى كما تشاء.
- تمت كتابة الشفرة بالإنجليزية لتسهيل الفهم لمن يرغب في التطوير، بينما تم شرح الاستخدام بالعربية لتلبية طلب المستخدم.

نأمل أن يكون هذا المشروع مفيداً لك كبداية لإنشاء موقعك الخاص. إذا واجهتك أي مشكلة يمكنك فتح تذكرة أو التواصل معنا لإيجاد الحل.